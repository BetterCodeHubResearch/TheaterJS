!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TheaterJS=t():e.TheaterJS=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),s=r(u),o=n(3),c=r(o),l=n(2),f=r(l),d=n(4),h=r(d),p=function(){function e(t){a(this,e);var n={autoplay:!0,erase:!0,loop:!0,minSpeed:50,maxSpeed:150};this.options=c["default"].merge({},n,t||{}),this.casting={},this.onStage="",this.status="ready",this.currentScene=-1,this.scenario=[]}return i(e,[{key:"describe",value:function(e,t,n){var r=new s["default"](e,t,n);return this.casting[r.name]=r,this}},{key:"addScene",value:function(){for(var e=c["default"].toArray(arguments);e.length;){var t=e.shift();if(f["default"].isString(t)){var n=t.split(":"),r=void 0;n.length>1&&"\\"!==n[0].charAt(n[0].length-1)&&(r=n.shift(),this.options.erase&&this.addScene({name:"erase",actor:r}));var a=n.join(":").replace(/\\:/g,":"),i={name:"type",args:[a]};null!=r&&(i.actor=r),this.addScene(i)}else f["default"].isFunction(t)?this.addScene({name:"callback",args:[t]}):f["default"].isNumber(t)?t>0?this.addScene({name:"wait",args:[t]}):this.addScene({name:"erase",args:[t]}):f["default"].isObject(t)&&(f["default"].isArray(t.args)||(t.args=[]),t.args.unshift(this.playNextScene.bind(this)),this.scenario.push(t))}return this.options.autoplay&&this.play(),this}},{key:"play",value:function(){return"ready"===this.status&&(this.status="playing",this.playNextScene()),this}},{key:"replay",value:function(e){return("ready"===this.status||f["default"].isFunction(e))&&(this.currentScene=-1,"ready"===this.status?this.play():e()),this}},{key:"playNextScene",value:function(){if(this.currentScene+1>=this.scenario.length)return this.status="ready",this;var e=this.scenario[++this.currentScene];switch(e.actor&&(this.onStage=e.actor),e.name){case"type":this.typeAction.apply(this,e.args);break;case"erase":this.eraseAction.apply(this,e.args);break;case"callback":this.callbackAction.apply(this,e.args);break;case"wait":this.waitAction.apply(this,e.args);break;default:console.debug("No scene handler for "+e.name)}return this}},{key:"typeAction",value:function(e,t){var n=this.casting[this.onStage],r=this.options.minSpeed,a=this.options.maxSpeed,i=n.displayValue,u=-1,s=!1,o=null;return function c(){var l=t.substr(0,u+1);if(l===t)return e();var f=t.substr(0,u+1),d=l!==f,p=n.shouldBeMistaken(l,f,t,o),y=s||!p;if(d&&y)s=!0,n.displayValue=n.displayValue.substr(0,n.displayValue.length-1),u--;else{s=!1;var g=t.charAt(++u);p&&(g=h["default"].randomCharNear(g),o=u),n.displayValue=i+t.substr(0,u)+g}return setTimeout(c,n.getTypingSpeed(r,a))}(),this}},{key:"eraseAction",value:function(e){var t=this.casting[this.onStage],n=this.options.minSpeed,r=this.options.maxSpeed,a=t.displayValue.length;return function i(){return 0===a?e():(t.displayValue=t.displayValue.substr(0,--a),setTimeout(i,t.getTypingSpeed(n,r)))}(),this}},{key:"callbackAction",value:function(e,t){return t.call(this,e),this}},{key:"waitAction",value:function(e,t){return setTimeout(e.bind(this),t),this}}]),e}();t["default"]=p,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(2),s=r(u),o=n(3),c=r(o),l=function(){function e(t,n,r){if(a(this,e),!s["default"].isString(t))throw new Error("actor must have a name");null==n&&(n={}),null==r&&document&&(r="#"+t),s["default"].isString(r)&&!function(){var e=document.querySelector(r);null!=e?r=function(t){e.innerHTML=t}:console.debug("selector for "+t+" (#"+t+") didn't match anything")}(),s["default"].isFunction(r)||(r=console.log.bind(console)),this.name=t,s["default"].isNumber(n)&&(n={experience:n}),s["default"].isNumber(n.experience)||(n.experience=.6);var i={speed:n.experience,accuracy:n.experience,invincibility:10*n.experience};c["default"].merge(this,i,n),this.callback=r,this._displayValue=""}return i(e,[{key:"getTypingSpeed",value:function(e,t){var n=c["default"].randomFloat(this.speed,1);return c["default"].getPercentageOf(e,t,n)}},{key:"shouldBeMistaken",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?null:arguments[3];if(e.length<=10*this.accuracy)return!1;if(e.substr(-3)!==t.substr(-3))return!1;if(e.length===n.length)return!1;if(s["default"].isNumber(r)){var a=e.length-r,i=10*this.accuracy-1;if(i>a)return!1}return c["default"].randomFloat(0,.8)>this.accuracy}},{key:"displayValue",set:function(e){this._displayValue=e,this.callback(e)},get:function(){return this._displayValue}}]),e}();t["default"]=l,e.exports=t["default"]},function(e,t){"use strict";function n(e){return{}.toString.call(e)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={isNumber:function(e){return"number"==typeof e},isString:function(e){return"[object String]"===n(e)},isObject:function(e){return"[object Object]"===n(e)},isArray:function(e){return"[object Array]"===n(e)},isFunction:function(e){return"function"==typeof e}},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={toArray:function(e){return[].slice.call(e)},merge:function(e){for(var t=[].slice.call(arguments,1),n=0,r=t.length;r>n;n++){var a=t[n];for(var i in a)a.hasOwnProperty(i)&&(e[i]=a[i])}return e},random:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},randomFloat:function(e,t){return Math.random()*(t-e)+e},getPercentageOf:function(e,t,n){return e-e*n+t*n}},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={randomCharNear:function(e){return"q"}},e.exports=t["default"]}])});