!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TheaterJS=t():e.TheaterJS=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),s=r(u),o=n(3),l=r(o),c=n(2),f=r(c),d=n(4),h=r(d),p=n(6),g=r(p),y=function(){function e(t){a(this,e);var n={autoplay:!0,erase:!0,loop:!0,minSpeed:80,maxSpeed:450,locale:"detect"};this.options=l["default"].merge({},n,t||{}),"detect"===this.options.locale&&null!=window&&null!=window.navigator&&f["default"].isArray(window.navigator.languages)&&f["default"].isString(window.navigator.languages[0])&&(this.options.locale=window.navigator.languages[0].substr(0,2)),h["default"].supports(this.options.locale)||(this.options.locale=h["default"].defaultLocale),this.casting={},this.status="ready",this.currentScene=-1,this.scenario=[],this.events={},this.setCurrentActor(null)}return i(e,[{key:"describe",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2],r=new s["default"](e,t,n);return this.casting[r.name]=r,this}},{key:"setCurrentActor",value:function(e){return this.onStage=e,this}},{key:"getCurrentActor",value:function(){return this.casting[this.onStage]||null}},{key:"addScene",value:function(){var e=this,t=l["default"].toArray(arguments);return t.forEach(function(t){if(f["default"].isString(t)){var n=t.split(":"),r=void 0;n.length>1&&"\\"!==n[0].charAt(n[0].length-1)&&(r=n.shift(),e.options.erase&&e.addScene({name:"erase",actor:r}));var a=n.join(":").replace(/\\:/g,":"),i={name:"type",args:[a]};null!=r&&(i.actor=r),e.addScene(i)}else f["default"].isFunction(t)?e.addScene({name:"callback",args:[t]}):f["default"].isNumber(t)?t>0?e.addScene({name:"wait",args:[t]}):e.addScene({name:"erase",args:[t]}):f["default"].isArray(t)?t.forEach(function(t){e.addScene(t)}):f["default"].isObject(t)&&(f["default"].isArray(t.args)||(t.args=[]),t.args.unshift(e.playNextScene.bind(e)),e.scenario.push(t))}),this.options.autoplay&&this.play(),this}},{key:"play",value:function(){return"ready"===this.status&&(this.status="playing",this.playNextScene()),this}},{key:"replay",value:function(e){return("ready"===this.status||f["default"].isFunction(e))&&(this.currentScene=-1,"ready"===this.status?this.play():e()),this}},{key:"stop",value:function(){return this.status="ready",this}},{key:"playNextScene",value:function(){if("playing"!==this.status)return this;var e=this.scenario[this.currentScene];if(null!=e&&this.publish(e.name+":end",e),this.currentScene+1>=this.scenario.length)return this.status="ready",this;var t=this.scenario[++this.currentScene];switch(t.actor&&this.setCurrentActor(t.actor),this.publish(t.name+":start",t),t.name){case"type":this.typeAction.apply(this,t.args);break;case"erase":this.eraseAction.apply(this,t.args);break;case"callback":this.callbackAction.apply(this,t.args);break;case"wait":this.waitAction.apply(this,t.args);break;default:console.debug("No scene handler for "+t.name)}return this}},{key:"typeAction",value:function(e,t){var n=this.getCurrentActor(),r=this.options.locale,a=this.options.minSpeed,i=this.options.maxSpeed,u=n.displayValue,s=-1,o=!1,l=null,c=null,f=g["default"].map(t);return t=g["default"].strip(t),function d(){var p=g["default"].strip(n.displayValue.substr(u.length));if(p===t)return e();var y=t.substr(0,s+1),v=p!==y,m=n.shouldBeMistaken(p,t,l,c),b=o||!m;if(v&&b)o=!0,l=null,n.displayValue=u+g["default"].inject(p.substr(0,p.length-1),f),s--,c=s;else{o=!1;var w=t.charAt(++s);m&&(w=h["default"].randomCharNear(w,r),null==l&&(l=s)),n.displayValue=u+g["default"].inject(p+w,f)}return setTimeout(d,n.getTypingSpeed(a,i))}(),this}},{key:"eraseAction",value:function(e,t){var n=this.getCurrentActor(),r=this.options.minSpeed,a=this.options.maxSpeed,i=n.displayValue,u=g["default"].map(i);i=g["default"].strip(i);var s=i.length,o=void 0,l=0;return f["default"].isNumber(t)&&(t>0?o=t:l=i.length+t),function c(){return s===l?e():(n.displayValue=g["default"].inject(i.substr(0,--s),u),setTimeout(c,o||n.getTypingSpeed(r,a)))}(),this}},{key:"callbackAction",value:function(e,t){return t.call(this,e),this}},{key:"waitAction",value:function(e,t){return setTimeout(e.bind(this),t),this}},{key:"subscribe",value:function(e,t){var n=this;return e.split(",").forEach(function(e){e=e.trim(),f["default"].isArray(n.events[e])||(n.events[e]=[]),n.events[e].push(t)}),this}},{key:"publish",value:function(e){var t=arguments,n=this;return f["default"].isArray(this.events[e])&&!function(){var r=[].slice.call(t,1);r.unshift(e);var a=(n.events[e]||[]).concat(n.events["*"]||[]);a.forEach(function(e){e.apply(this,r)})}(),this}}]),e}();t["default"]=y,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(2),s=r(u),o=n(3),l=r(o),c={speed:.6,accuracy:.6},f=function(){function e(t){var n=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=arguments.length<=2||void 0===arguments[2]?null:arguments[2];if(a(this,e),this.name=t,s["default"].isNumber(r)&&(r={speed:r,accuracy:r}),l["default"].merge(this,c,r),null!=document&&(null==i&&(i="#"+t),s["default"].isString(i))){var u=i,o=document.querySelector(u);if(null==o)throw new Error("no matches for "+this.name+"'s selector: "+u);this.$element=o,i=function(e){n.$element.innerHTML=e}}s["default"].isFunction(i)||(i=console.log.bind(console)),this.callback=i,this._displayValue=""}return i(e,[{key:"getTypingSpeed",value:function(e,t){var n=l["default"].randomFloat(this.speed,1);return l["default"].getPercentageOf(t,e,n)}},{key:"shouldBeMistaken",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?null:arguments[2],r=arguments.length<=3||void 0===arguments[3]?null:arguments[3],a=10*this.accuracy;if(a>=8)return!1;if(e.length<=a)return!1;if(e.length===t.length)return!1;if(s["default"].isNumber(n)){var i=e.length-n,u=a>=6?10-a:4;if(i>=u)return!1}if(s["default"].isNumber(r)){var i=e.length-r,o=2*Math.max(a,2);if(o>=i)return!1}return l["default"].randomFloat(0,.8)>this.accuracy}},{key:"displayValue",set:function(e){this._displayValue=e,this.callback(e)},get:function(){return this._displayValue}}]),e}();t["default"]=f,e.exports=t["default"]},function(e,t){"use strict";function n(e){return{}.toString.call(e)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={isNumber:function(e){return"number"==typeof e},isString:function(e){return"[object String]"===n(e)},isObject:function(e){return"[object Object]"===n(e)},isArray:function(e){return"[object Array]"===n(e)},isFunction:function(e){return"function"==typeof e}},e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={toArray:function(e){return[].slice.call(e)},merge:function(e){for(var t=[].slice.call(arguments,1),n=0,r=t.length;r>n;n++){var a=t[n];for(var i in a)a.hasOwnProperty(i)&&(e[i]=a[i])}return e},random:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},randomFloat:function(e,t){return Math.random()*(t-e)+e},getPercentageOf:function(e,t,n){return e-e*n+t*n}},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e){for(var t={},n=0,r=e.length,a=void 0;r>n;n++){a=e[n];for(var i=0,u=a.length;u>i;i++)t[a[i]]={x:i,y:n}}return t}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),u=r(i),s=n(3),o=r(s),l=n(5),c=r(l),f="en";for(var d in c["default"])if(c["default"].hasOwnProperty(d)){var h=c["default"][d];c["default"][d]={list:h,mapped:a(h)}}t["default"]={defaultLocale:f,supports:function(e){return u["default"].isObject(c["default"][e])},randomCharNear:function(e,t){if(!this.supports(t))throw new Error('locale "'+t+'" is not supported');var n=c["default"][t].mapped,r=1,a=[],i=/[A-Z]/.test(e);e=e.toLowerCase();var u=n[e]||[],s=void 0;for(var l in n)n.hasOwnProperty(l)&&l!==e&&(s=n[l],Math.abs(u.x-s.x)<=r&&Math.abs(u.y-s.y)<=r&&a.push(l));var f=a.length>0?a[o["default"].random(0,a.length-1)]:this.randomChar(t);return i&&(f=f.toUpperCase()),f},randomChar:function(e){if(!this.supports(e))throw new Error('locale "'+e+'" is not supported');var t=c["default"][e].list.join("");return t.charAt(o["default"].random(0,t.length-1))}},e.exports=t["default"]},function(e,t){e.exports={en:["qwertyuiop","asdfghjkl","zxcvbnm"],fr:["azertyuiop","qsdfghjklm","wxcvbn"],da:["qwertyuiopå","asdfghjklæø","zxcvbnm"],de:["qwertzuiopü","asdfghjklöä","yxcvbnm"],pl:["qwertyuiopęó","asdfghjkląśł","zxcvbnmżźćń"],pt:["qwertyuiop","asdfghjklç","zxcvbnm"],ru:["йцукенгшщзх","фывапролджэ","ячсмитьбюъ"]}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={strip:function(e){return e.replace(/(<([^>]+)>)/gi,"")},map:function(e){for(var t=/<[^>]+>/gi,n=[],r=[],a=void 0,i=void 0;a=t.exec(e);)i={tagName:a[0],position:a.index},"/"===i.tagName.charAt(1)?i.opener=r.pop():"/"!==i.tagName.charAt(i.tagName.length-2)&&r.push(i),n.push(i);return n},inject:function(e,t){for(var n=0,r=void 0;n<t.length;n++)r=t[n],e.length>0&&r.position<=e.length?e=e.substr(0,r.position)+r.tagName+e.substr(r.position):r.opener&&r.opener.position<e.length&&(e+=r.tagName);return e}},e.exports=t["default"]}])});