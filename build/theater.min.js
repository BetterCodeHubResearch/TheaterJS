!function(t,e){function r(t){var e=this,r={autoplay:!0,erase:!0,locale:"detect"};e.options=e.utils.merge(r,t||{}),"detect"===e.options.locale&&(e.options.locale=(window.navigator.languages||["en"])[0].split("-")[0]),e.keyboards[e.options.locale]||(e.options.locale="en"),e.utils.keyboard=e.keyboards[e.options.locale],e.events={},e.scene=-1,e.scenario=[],e.casting={},e.current={},e.state="ready"}r.prototype={constructor:r,version:"1.1.0",keyboards:{},set:function(t,e){var r=this;switch(r.current.model=t,r.current.type){case"function":r.current.voice.apply(r,e);break;default:r.current.voice.innerHTML=t}return r},getSayingSpeed:function(t,e){"number"!=typeof t&&(e=t,t=0);var r=this,n=r.current.speed+t;n>1&&(n=1);var a=e?n:r.utils.randomFloat(n,1);return r.utils.getPercentageBetween(1e3,50,a)},isMistaking:function(){var t=this;return t.utils.randomFloat(0,1)>t.current.accuracy},parseHTML:function(t){var e=this;e.current.htmlStartTags=[],e.current.htmlEndTags=[];for(var r={pos:-1,length:-1,string:""},n=0;n<t.length;n++){var a=t.charAt(n);if("<"===a&&(r.pos=n),r.pos>=0&&(r.string+=a),">"===a){r.length=n-r.pos+1;var s={pos:r.pos,length:r.length,string:r.string};"/"===r.string.charAt(1)?e.current.htmlEndTags.push(s):e.current.htmlStartTags.push(s),r.pos=-1,r.length=-1,r.string=""}}},stripHTML:function(t){for(var e=this,r=0;r<e.current.htmlStartTags.length;r++)t=t.replace(e.current.htmlStartTags[r].string,""),t=t.replace(e.current.htmlEndTags[r].string,"");return t},injectHTML:function(t,e){for(var r=this,n=r.current.htmlStartTags.length,a=0,s=0,i=0;n>s;){var o=r.current.htmlStartTags[s],c=r.current.htmlEndTags[i];if(o.pos<c.pos){if(!(o.pos<=e+a)){for(var u=s-1;u>=i;u--)t+=r.current.htmlEndTags[u].string;return t}t=t.substr(0,o.pos)+o.string+t.substr(o.pos),a+=o.length,s++}else{if(!(c.pos<=e+a))return t;t=t.substr(0,c.pos)+c.string+t.substr(c.pos),a+=c.length,i++}}return t},utils:{keyboard:{},isNumber:function(t){return"number"==typeof t},isObject:function(t){return t instanceof Object},mapKeyboard:function(t){for(var e,r={},n=0,a=t.length;a>n;n++){e=t[n];for(var s=0,i=e.length;i>s;s++)r[e[s]]={x:s,y:n}}return r},merge:function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},getPercentageBetween:function(t,e,r){return t-t*r+e*r},randomCharNear:function(t){var e=this,r=e.mapKeyboard(e.keyboard),n=1,a=[],s=!!t.match(/[A-Z]/);t=t.toLowerCase();var i,o,c=r[t]||[];for(i in r)r.hasOwnProperty(i)&&i!==t&&(o=r[i],Math.abs(c.x-o.x)<=n&&Math.abs(c.y-o.y)<=n&&a.push(i));var u=a.length>0?a[e.randomNumber(0,a.length-1)]:e.randomChar();return s?u.toUpperCase():u},randomChar:function(){var t=this,e=t.keyboard.join("");return e.charAt(t.randomNumber(0,e.length-1))},randomNumber:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},randomFloat:function(t,e){return Math.round(10*(Math.random()*(e-t)+t))/10},hasClass:function(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)},addClass:function(t,e){t.classList?t.classList.add(e):t.className+=" "+e},removeClass:function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}},train:function(t){var e=this,r={experience:.6,voice:function(t){console.log(t)},type:"function",model:""};return t=e.utils.merge(r,t),e.utils.isNumber(t.speed)||(t.speed=t.experience),e.utils.isNumber(t.accuracy)||(t.accuracy=t.experience),e.utils.isNumber(t.invincibility)||(t.invincibility=10*t.accuracy),t},describe:function(t,r,n){if("string"!=typeof t)throw"actor's name has wrong type: "+typeof t;var a=this,s={name:t};return a.utils.isNumber(r)?s.experience=r:a.utils.isObject(r)&&(s=a.utils.merge(s,r)),void 0!==n&&(s.type="function"==typeof n?"function":"DOM",s.voice="DOM"===s.type&&"string"==typeof n?e.querySelector(n):n),a.casting[t]=a.train(s),a},write:function(){for(var t,e=this,r=Array.prototype.splice.apply(arguments,[0]),n=0,a=r.length;a>n;n++)if(t=r[n],"string"==typeof t){var s=t.split(":"),i=s.length>1&&"\\"!==s[0].charAt(s[0].length-1),o=i?s.shift().trim():null,c=s.join(":").replace(/\\:/g,":");i&&e.write({name:"actor",args:[o]}),e.options.erase&&i&&e.write({name:"erase"}),e.write({name:"say",args:[c,!i]})}else"number"==typeof t?e.write(0>t?{name:"erase",args:[t]}:{name:"wait",args:[t]}):"function"==typeof t?e.write({name:"call",args:[t]}):t instanceof Object&&e.scenario.push(t);return e.options.autoplay&&e.play(),e},play:function(t){var e=this;return t===!0&&(e.scene=-1),"ready"===e.state&&e.next(),e},on:function(t,e){var r=this;t=t.split(",");for(var n,a=0,s=t.length;s>a;a++)n=t[a]=t[a].trim(),(r.events[n]||(r.events[n]=[])).push(e);return r},emit:function(t,e,r){if("string"!=typeof t)throw"emit: scope missing";"string"!=typeof e?e=void 0:void 0!==e&&void 0===r&&(r=e);var n=this,a=t+(e?":"+e:"");return n.trigger(a,r).trigger("*",[a].concat(r)),n},trigger:function(t,e){var r=this,n=r.events[t]||[];e instanceof Array||(e=[e]);for(var a=0,s=n.length;s>a;a++)n[a].apply(r,[t].concat(e));return r},call:function(t,e){var r=this;return t.apply(r),e?r:r.next()},next:function(){var t=this,e=t.scenario[t.scene];if(e&&t.emit(e.name,"end",[e.name].concat(e.args)),t.scene+1>=t.scenario.length)t.state="ready";else{t.state="playing";var r=t.scenario[++t.scene];t.emit(r.name,"start",[r.name].concat(r.args)),t[r.name].apply(t,r.args)}return t},actor:function(t){var e=this;return e.current=e.casting[t],e.next()},say:function(t,e){var r,n,a=this,s=!1,i=a.current.invincibility;e?(n=a.current.model,r=a.current.model.length-1,t=n+t):(n=a.current.model="",r=-1),a.parseHTML(t),t=a.stripHTML(t);var o=setTimeout(function c(){var e,u,l=n.charAt(r);s?(i=a.current.invincibility,s=!1,e=null,u=n=n.substr(0,r),r--):(r++,e=t.charAt(r),--i<0&&(l!==e||a.current.accuracy<=.3)&&a.isMistaking()&&(e=a.utils.randomCharNear(e)),e!==t.charAt(r)&&(s=!0),u=n+=e),u=a.injectHTML(u,r),a.set(u,[u,e,l,t]),s||r<t.length?o=setTimeout(c,a.getSayingSpeed()):a.next()},a.getSayingSpeed());return a},erase:function(t){var e=this;if("string"!=typeof e.current.model)return e.next();void 0===e.current.htmlStartTags&&e.parseHTML(e.current.model);{var r=e.stripHTML(e.current.model),n=r.length,a=0>t?n+1+t:0;setTimeout(function s(){var t=r.charAt(n),i=r.substr(0,--n);i=e.injectHTML(i,n),e.set(i,[i,null,t,i]),r=e.stripHTML(i),n>=a?setTimeout(s,e.getSayingSpeed(.2,!0)):e.next()},e.getSayingSpeed(.2,!0))}return e},wait:function(t){var e=this;return setTimeout(function(){e.next()},t),e}},r.prototype.keyboards.en=["qwertyuiop","asdfghjkl","zxcvbnm"],r.prototype.keyboards.fr=["azertyuiop","qsdfghjklm","wxcvbn"],t.TheaterJS=r}(window,document);