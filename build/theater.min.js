!function(t,e){function n(t){var e=this,n={autoplay:!0,erase:!0,locale:"detect"};e.options=e.utils.merge(n,t||{}),"detect"===e.options.locale&&(e.options.locale=(window.navigator.languages||["en"])[0].split("-")[0]),e.keyboards[e.options.locale]||(e.options.locale="en"),e.utils.keyboard=e.keyboards[e.options.locale],e.events={},e.scene=-1,e.scenario=[],e.casting={},e.current={},e.state="ready"}n.prototype={constructor:n,version:"1.2.0",keyboards:{},set:function(t,e){var n=this,r=n.current.voice;return n.current.model=t,n.utils.isFunction(r)?r.apply(n,e):r.innerHTML=t,n},getSayingSpeed:function(t,e){"number"!=typeof t&&(e=t,t=0);var n=this,r=n.current.speed+t;r>1&&(r=1);var i=e?r:n.utils.randomFloat(r,1);return n.utils.getPercentageBetween(1e3,50,i)},isMistaking:function(){var t=this;return t.utils.randomFloat(0,.8)>t.current.accuracy},utils:{keyboard:{},copy:function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n},isFunction:function(t){return"function"==typeof t},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:function(t){return t instanceof Object},stripHTML:function(t){return t.replace(/(<([^>]+)>)/gi,"")},mapHTML:function(t){for(var e,n,r=this,i=[],a=[],s={position:-1,tagName:""},o=r.copy(s),c=0,u=t.length;u>c;c++)n=t.charAt(c),"<"===n&&(o.position=c),o.position>=0&&(o.tagName+=n),">"===n&&(e=r.copy(o),"/"===o.tagName.charAt(1)?a.push(e):i.push(e),o=r.copy(s));return{openers:i,closers:a}},injectHTML:function(t,e){var n,r,i,a;for(n=0,r=e.openers.length;r>n&&(i=e.openers[n],i.position<t.length);n++)t=t.substr(0,i.position)+i.tagName+t.substr(i.position);for(n=0,r=e.closers.length;r>n;n++)i=e.openers[n],a=e.closers[n],a.position<=t.length?t=t.substr(0,a.position)+a.tagName+t.substr(a.position):i.position<=t.length&&(t+=a.tagName);return t},mapKeyboard:function(t){for(var e,n={},r=0,i=t.length;i>r;r++){e=t[r];for(var a=0,s=e.length;s>a;a++)n[e[a]]={x:a,y:r}}return n},merge:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},getPercentageBetween:function(t,e,n){return t-t*n+e*n},randomCharNear:function(t){var e=this,n=e.mapKeyboard(e.keyboard),r=1,i=[],a=!!t.match(/[A-Z]/);t=t.toLowerCase();var s,o,c=n[t]||[];for(s in n)n.hasOwnProperty(s)&&s!==t&&(o=n[s],Math.abs(c.x-o.x)<=r&&Math.abs(c.y-o.y)<=r&&i.push(s));var u=i.length>0?i[e.randomNumber(0,i.length-1)]:e.randomChar();return a?u.toUpperCase():u},randomChar:function(){var t=this,e=t.keyboard.join("");return e.charAt(t.randomNumber(0,e.length-1))},randomNumber:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},randomFloat:function(t,e){return Math.round(10*(Math.random()*(e-t)+t))/10},hasClass:function(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)},addClass:function(t,e){t.classList?t.classList.add(e):t.className+=" "+e},removeClass:function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}},train:function(t){var e=this,n={experience:.6,voice:function(t){console.log(t)},model:""};return t=e.utils.merge(n,t),e.utils.isNumber(t.speed)||(t.speed=t.experience),e.utils.isNumber(t.accuracy)||(t.accuracy=t.experience),e.utils.isNumber(t.invincibility)||(t.invincibility=10*t.accuracy),t},describe:function(t,n,r){var i=this,a={name:t};return i.utils.isNumber(n)?a.experience=n:i.utils.isObject(n)&&(a=i.utils.merge(a,n)),void 0!==r&&(a.voice=i.utils.isString(r)?e.querySelector(r):r),i.casting[t]=i.train(a),i},write:function(){for(var t,e=this,n=Array.prototype.splice.apply(arguments,[0]),r=0,i=n.length;i>r;r++)if(t=n[r],e.utils.isString(t)){var a=t.split(":"),s=a.length>1&&"\\"!==a[0].charAt(a[0].length-1),o=s?a.shift().trim():null,c=a.join(":").replace(/\\:/g,":");s&&e.write({name:"actor",args:[o]}),e.options.erase&&s&&e.write({name:"erase"}),e.write({name:"say",args:[c,!s]})}else"number"==typeof t?e.write(0>t?{name:"erase",args:[t]}:{name:"wait",args:[t]}):"function"==typeof t?e.write({name:"call",args:[t]}):t instanceof Object&&e.scenario.push(t);return e.options.autoplay&&e.play(),e},play:function(t){var e=this;return t===!0&&(e.scene=-1),"ready"===e.state&&e.next(),e},on:function(t,e){var n=this;t=t.split(",");for(var r,i=0,a=t.length;a>i;i++)r=t[i]=t[i].trim(),(n.events[r]||(n.events[r]=[])).push(e);return n},emit:function(t,e,n){var r=this;r.utils.isString(e)?void 0!==e&&void 0===n&&(n=e):e=void 0;var i=t+(e?":"+e:"");return r.trigger(i,n).trigger("*",[i].concat(n)),r},trigger:function(t,e){var n=this,r=n.events[t]||[];e instanceof Array||(e=[e]);for(var i=0,a=r.length;a>i;i++)r[i].apply(n,[t].concat(e));return n},call:function(t,e){var n=this;return t.apply(n),e?n:n.next()},next:function(){var t=this,e=t.scenario[t.scene];if(e&&t.emit(e.name,"end",[e.name].concat(e.args)),t.scene+1>=t.scenario.length)t.state="ready";else{t.state="playing";var n=t.scenario[++t.scene];t.emit(n.name,"start",[n.name].concat(n.args)),t[n.name].apply(t,n.args)}return t},actor:function(t){var e=this;return e.current=e.casting[t],e.next()},say:function(t,e){var n,r,i=this,a=!1,s=i.current.invincibility;i.current.raw=t,t=i.utils.stripHTML(t),e?(r=i.current.model,n=i.current.model.length-1,t=r+t):(r=i.current.model="",n=-1);var o=setTimeout(function c(){var e,u,l=r.charAt(n);a?(s=i.current.invincibility,a=!1,e=null,u=r=r.substr(0,n),n--):(n++,e=t.charAt(n),--s<0&&(l!==e||i.current.accuracy<=.3)&&i.isMistaking()&&(e=i.utils.randomCharNear(e)),e!==t.charAt(n)&&(a=!0),u=r+=e),i.set(u,[u,e,l,t]),a||n<t.length?o=setTimeout(c,i.getSayingSpeed()):i.next()},i.getSayingSpeed());return i},erase:function(t){var e=this;if(!e.utils.isString(e.current.model))return e.next();{var n=e.current.model,r=n.length,i=0>t?r+1+t:0;setTimeout(function a(){var t=n.charAt(r),s=n.substr(0,--r);e.set(s,[s,null,t,s]),n=s,r>=i?setTimeout(a,e.getSayingSpeed(.2,!0)):e.next()},e.getSayingSpeed(.2,!0))}return e},wait:function(t){var e=this;return setTimeout(function(){e.next()},t),e}},n.prototype.keyboards.en=["qwertyuiop","asdfghjkl","zxcvbnm"],n.prototype.keyboards.fr=["azertyuiop","qsdfghjklm","wxcvbn"],t.TheaterJS=n}(window,document);