!function(e,t){function n(e){var t=this,n={autoplay:!0,erase:!0,locale:"detect",minSpeed:50,maxSpeed:1e3};t.options=t.utils.merge(n,e||{}),"detect"===t.options.locale&&(t.options.locale=(window.navigator.languages||["en"])[0].split("-")[0]),t.keyboards[t.options.locale]||(t.options.locale="en"),t.utils.keyboard=t.keyboards[t.options.locale],t.events={},t.scene=-1,t.scenario=[],t.casting={},t.current={},t.state="ready"}n.prototype={constructor:n,version:"1.2.0",keyboards:{},set:function(e,t){var n=this,r=n.current.voice,i=n.current.html||[];return t[0]=n.utils.injectHTML(t[0],i),n.current.model=n.utils.injectHTML(e,i),n.utils.isFunction(r)?r.apply(n,t):r.innerHTML=n.current.model,n},getSayingSpeed:function(e,t){"number"!=typeof e&&(t=e,e=0);var n=this,r=n.current.speed+e;r>1&&(r=1);var i=t?r:n.utils.randomFloat(r,1);return n.utils.getPercentageBetween(n.options.maxSpeed,n.options.minSpeed,i)},isMistaking:function(){var e=this;return e.utils.randomFloat(0,.8)>e.current.accuracy},utils:{keyboard:{},copy:function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n},isFunction:function(e){return"function"==typeof e},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:function(e){return e instanceof Object},stripHTML:function(e){return e.replace(/(<([^>]+)>)/gi,"")},mapHTML:function(e){for(var t,n,r=/<[^>]+>/gi,i=[],a=[];t=r.exec(e);)n={tagName:t[0],position:t.index},"/"===n.tagName.charAt(1)?n.opener=a.pop():"/"!==n.tagName.charAt(n.tagName.length-2)&&a.push(n),i.push(n);return i},injectHTML:function(e,t){for(var n,r=0,i=t.length;i>r;r++)n=t[r],n.position<e.length?e=e.substr(0,n.position)+n.tagName+e.substr(n.position):n.opener&&n.opener.position<e.length&&(e+=n.tagName);return e},mapKeyboard:function(e){for(var t,n={},r=0,i=e.length;i>r;r++){t=e[r];for(var a=0,s=t.length;s>a;a++)n[t[a]]={x:a,y:r}}return n},merge:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},getPercentageBetween:function(e,t,n){return e-e*n+t*n},randomCharNear:function(e){var t=this,n=t.mapKeyboard(t.keyboard),r=1,i=[],a=!!e.match(/[A-Z]/);e=e.toLowerCase();var s,o,c=n[e]||[];for(s in n)n.hasOwnProperty(s)&&s!==e&&(o=n[s],Math.abs(c.x-o.x)<=r&&Math.abs(c.y-o.y)<=r&&i.push(s));var u=i.length>0?i[t.randomNumber(0,i.length-1)]:t.randomChar();return a?u.toUpperCase():u},randomChar:function(){var e=this,t=e.keyboard.join("");return t.charAt(e.randomNumber(0,t.length-1))},randomNumber:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},randomFloat:function(e,t){return Math.round(10*(Math.random()*(t-e)+e))/10},hasClass:function(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)},addClass:function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},removeClass:function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")}},train:function(e){var t=this,n={experience:.6,voice:function(e){console.log(e)},model:""};return e=t.utils.merge(n,e),t.utils.isNumber(e.speed)||(e.speed=e.experience),t.utils.isNumber(e.accuracy)||(e.accuracy=e.experience),t.utils.isNumber(e.invincibility)||(e.invincibility=10*e.accuracy),e},describe:function(e,n,r){var i=this,a={name:e};return i.utils.isNumber(n)?a.experience=n:i.utils.isObject(n)&&(a=i.utils.merge(a,n)),void 0!==r&&(a.voice=i.utils.isString(r)?t.querySelector(r):r),i.casting[e]=i.train(a),i},write:function(){for(var e,t=this,n=Array.prototype.splice.apply(arguments,[0]),r=0,i=n.length;i>r;r++)if(e=n[r],t.utils.isString(e)){var a=e.split(":"),s=a.length>1&&"\\"!==a[0].charAt(a[0].length-1),o=s?a.shift().trim():null,c=a.join(":").replace(/\\:/g,":");s&&t.write({name:"actor",args:[o]}),t.options.erase&&s&&t.write({name:"erase"}),t.write({name:"say",args:[c,!s]})}else"number"==typeof e?t.write(0>e?{name:"erase",args:[e]}:{name:"wait",args:[e]}):"function"==typeof e?t.write({name:"call",args:[e]}):e instanceof Object&&t.scenario.push(e);return t.options.autoplay&&t.play(),t},play:function(e){var t=this;return e===!0&&(t.scene=-1),"ready"===t.state&&t.next(),t},on:function(e,t){var n=this;e=e.split(",");for(var r,i=0,a=e.length;a>i;i++)r=e[i]=e[i].trim(),(n.events[r]||(n.events[r]=[])).push(t);return n},emit:function(e,t,n){var r=this;r.utils.isString(t)?void 0!==t&&void 0===n&&(n=t):t=void 0;var i=e+(t?":"+t:"");return r.trigger(i,n).trigger("*",[i].concat(n)),r},trigger:function(e,t){var n=this,r=n.events[e]||[];t instanceof Array||(t=[t]);for(var i=0,a=r.length;a>i;i++)r[i].apply(n,[e].concat(t));return n},call:function(e,t){var n=this;return e.apply(n),t?n:n.next()},next:function(){var e=this,t=e.scenario[e.scene];if(t&&e.emit(t.name,"end",[t.name].concat(t.args)),e.scene+1>=e.scenario.length)e.state="ready";else{e.state="playing";var n=e.scenario[++e.scene];e.emit(n.name,"start",[n.name].concat(n.args)),e[n.name].apply(e,n.args)}return e},actor:function(e){var t=this;return t.current=t.casting[e],t.next()},say:function(e,t){var n,r,i=this,a=!1,s=i.current.invincibility;i.current.html=i.utils.mapHTML(e),e=i.utils.stripHTML(e),t?(r=i.current.model,n=i.current.model.length-1,e=r+e):(r=i.current.model="",n=-1);var o=setTimeout(function c(){var t,u,l=r.charAt(n);a?(s=i.current.invincibility,a=!1,t=null,u=r=r.substr(0,n),n--):(n++,t=e.charAt(n),--s<0&&(l!==t||i.current.accuracy<=.3)&&i.isMistaking()&&(t=i.utils.randomCharNear(t)),t!==e.charAt(n)&&(a=!0),u=r+=t),i.set(u,[u,t,l,e]),a||n<e.length?o=setTimeout(c,i.getSayingSpeed()):i.next()},i.getSayingSpeed());return i},erase:function(e){var t=this;if(!t.utils.isString(t.current.model))return t.next();{var n=t.utils.stripHTML(t.current.model),r=n.length,i=0>e?r+1+e:0;setTimeout(function a(){var e=n.charAt(r),s=n.substr(0,--r);t.set(s,[s,null,e,s]),n=s,r>=i?setTimeout(a,t.getSayingSpeed(.2,!0)):t.next()},t.getSayingSpeed(.2,!0))}return t},wait:function(e){var t=this;return setTimeout(function(){t.next()},e),t}},n.prototype.keyboards.en=["qwertyuiop","asdfghjkl","zxcvbnm"],n.prototype.keyboards.fr=["azertyuiop","qsdfghjklm","wxcvbn"],e.TheaterJS=n}(window,document);